generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
  SUPERADMIN
}

enum CarStatus {
  AVAILABLE
  RENTED
  MAINTENANCE
  OUT_OF_SERVICE
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

model User {
  id        String    @id @default(cuid())
  email     String    @unique
  name      String?
  password  String?   // Hashed
  phone     String?
  taxId     String?
  companyName String?
  isBanned  Boolean   @default(false)
  banReason String?
  role      Role      @default(USER)
  bookings  Booking[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

enum FuelType {
  PETROL
  DIESEL
  ELECTRIC
  HYBRID
}

enum Transmission {
  MANUAL
  AUTOMATIC
}

model Car {
  id                 String         @id @default(cuid())
  make               String
  model              String
  description        String?
  year               Int
  licensePlate       String         @unique
  mileage            Int            // Current mileage
  
  // Technical Details
  categories         Category[]
  seats              Int            @default(5)
  doors              Int            @default(5)
  suitcases          Int            @default(2)
  transmission       Transmission   @default(MANUAL)
  fuelType           FuelType       @default(PETROL)
  
  // Attributes
  orSimilar          Boolean        @default(false)
  airConditioning    Boolean        @default(true)
  fuelPolicy         String         @default("FULL_TO_FULL") // FULL_TO_FULL, SAME_TO_SAME
  dailyMileageLimit  Int?           // null = unlimited
  
  // Prices
  pricePerDay        Decimal
  deposit            Decimal        @default(0)
  fullInsurancePrice Decimal        @default(0)
  pickupAfterHoursPrice Decimal     @default(0)
  returnAfterHoursPrice Decimal     @default(0)
  extraKmPrice          Decimal     @default(0)
  unlimitedMileagePrice Decimal     @default(0)
  registrationFee       Decimal     @default(0)
  contractFee           Decimal     @default(0)
  winterizationFee      Decimal     @default(0)
  
  isFeatured         Boolean        @default(false)
  
  status             CarStatus      @default(AVAILABLE)
  imageUrl           String?        // Main image
  images             String[]       // Additional images (Vercel Blob URLs)
  features           String[]
  bookings           Booking[]
  damageReports      DamageReport[]
  pricingTiers       PricingTier[]
  availabilities     Availability[]
  insuranceOptions   CarInsurance[]
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
}

model Category {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String?
  imageUrl    String?
  cars        Car[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Settings {
  id          String   @id @default("settings") // Singleton
  openingTime String   @default("08:00")
  closingTime String   @default("18:00")
  weeklyHours Json?    // Structured weekly opening hours
  updatedAt   DateTime @updatedAt
}

model Extra {
  id          String    @id @default(cuid())
  name        String
  description String?
  price       Decimal
  priceType   String    @default("PER_DAY") // PER_DAY, PER_RENTAL
  icon        String?   // Lucide icon name or emoji
  bookings    Booking[]
}

model InsurancePlan {
  id          String   @id @default(cuid())
  name        String
  description String?
  isDefault   Boolean  @default(false)
  order       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  carInsurances CarInsurance[]
  bookings      Booking[]
}

model CarInsurance {
  id          String        @id @default(cuid())
  carId       String
  car         Car           @relation(fields: [carId], references: [id], onDelete: Cascade)
  planId      String
  plan        InsurancePlan @relation(fields: [planId], references: [id], onDelete: Cascade)
  
  pricePerDay Decimal       @default(0)
  deposit     Decimal       @default(0)
  
  @@unique([carId, planId])
}

model Booking {
  id              String        @id @default(cuid())
  startDate       DateTime
  endDate         DateTime
  totalPrice      Decimal
  status          BookingStatus @default(PENDING)
  userId          String?       // Optional to allow guest bookings if needed, but schema says relation is mandatory. 
                              // If we allow guest booking, we might need to create a User or make this optional. 
                              // For now, let's keep it mandatory and create a user on the fly or require login.
  user            User?         @relation(fields: [userId], references: [id])
  
  carId           String
  car             Car           @relation(fields: [carId], references: [id])
  extras          Extra[]
  
  // Renter Details
  firstName       String
  lastName        String
  email           String
  phone           String
  flightNumber    String?
  comments        String?
  
  // Company Details
  isCompany       Boolean       @default(false)
  companyName     String?
  companyAddress  String?
  companyTaxId    String?
  companyEmail    String?
  companyPhone    String?

  // Payment
  paymentMethod   String        @default("CASH_ON_SITE") // CASH_ON_SITE, CARD_ON_SITE, PREPAYMENT
  
  // Booking Details
  pickupLocation  String        @default("Budapest Airport")
  dropoffLocation String        @default("Budapest Airport")
  fullInsurance   Boolean       @default(false)
  insurancePlanId String?
  insurancePlan   InsurancePlan? @relation(fields: [insurancePlanId], references: [id])
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
}

model DamageReport {
  id          String   @id @default(cuid())
  description String
  images      String[] // Vercel Blob URLs
  carId       String
  car         Car      @relation(fields: [carId], references: [id])
  createdAt   DateTime @default(now())
}

model PricingTier {
  id          String   @id @default(cuid())
  carId       String
  car         Car      @relation(fields: [carId], references: [id])
  minDays     Int
  maxDays     Int?
  pricePerDay Decimal
  deposit     Decimal
  createdAt   DateTime @default(now())
}

model Availability {
  id        String    @id @default(cuid())
  carId     String
  car       Car       @relation(fields: [carId], references: [id])
  startDate DateTime
  endDate   DateTime
  status    CarStatus
  createdAt DateTime  @default(now())
}

model Translation {
  id          String   @id @default(cuid())
  entityId    String   // ID of the entity being translated (Car ID, Extra ID, etc.)
  entityType  String   // "Car", "Extra", "Category", etc.
  field       String   // Field name (e.g., "description", "name")
  language    String   // "he", "en", etc.
  value       String   // The translated text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([entityId, entityType, field, language])
}
