generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String    @id @default(cuid())
  email       String    @unique
  name        String?
  password    String?
  role        Role      @default(USER)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  banReason   String?
  companyName String?
  isBanned    Boolean   @default(false)
  phone       String?
  taxId       String?
  bookings    Booking[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Car {
  id                    String         @id @default(cuid())
  make                  String
  model                 String
  year                  Int
  licensePlate          String         @unique
  mileage               Int
  pricePerDay           Decimal
  status                CarStatus      @default(AVAILABLE)
  imageUrl              String?
  images                String[]
  features              String[]
  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt
  deposit               Decimal        @default(0)
  fullInsurancePrice    Decimal        @default(0)
  airConditioning       Boolean        @default(true)
  dailyMileageLimit     Int?
  doors                 Int            @default(5)
  fuelPolicy            String         @default("FULL_TO_FULL")
  fuelType              FuelType       @default(PETROL)
  orSimilar             Boolean        @default(false)
  pickupAfterHoursPrice Decimal        @default(0)
  returnAfterHoursPrice Decimal        @default(0)
  seats                 Int            @default(5)
  suitcases             Int            @default(2)
  transmission          Transmission   @default(MANUAL)
  contractFee           Decimal        @default(0)
  extraKmPrice          Decimal        @default(0)
  registrationFee       Decimal        @default(0)
  unlimitedMileagePrice Decimal        @default(0)
  winterizationFee      Decimal        @default(0)
  isFeatured            Boolean        @default(false)
  description           String?
  vin                   String?        @unique
  renteonId             String?        @unique
  availabilities        Availability[]
  bookings              Booking[]
  insuranceOptions      CarInsurance[]
  damageReports         DamageReport[]
  pricingTiers          PricingTier[]
  categories            Category[]     @relation("CarToCategory")
}

model Category {
  id          String   @id @default(cuid())
  name        String   @unique
  slug        String   @unique
  description String?
  imageUrl    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  cars        Car[]    @relation("CarToCategory")
}

model Settings {
  id          String   @id @default("settings")
  openingTime String   @default("08:00")
  closingTime String   @default("18:00")
  updatedAt   DateTime @updatedAt
  weeklyHours Json?
}

model Extra {
  id          String    @id @default(cuid())
  name        String
  description String?
  price       Decimal
  priceType   String    @default("PER_DAY")
  icon        String?
  bookings    Booking[] @relation("BookingToExtra")
}

model InsurancePlan {
  id            String         @id @default(cuid())
  name          String
  description   String?
  isDefault     Boolean        @default(false)
  order         Int            @default(0)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  bookings      Booking[]
  carInsurances CarInsurance[]
}

model CarInsurance {
  id          String        @id @default(cuid())
  carId       String
  planId      String
  pricePerDay Decimal       @default(0)
  deposit     Decimal       @default(0)
  car         Car           @relation(fields: [carId], references: [id], onDelete: Cascade)
  plan        InsurancePlan @relation(fields: [planId], references: [id], onDelete: Cascade)

  @@unique([carId, planId])
}

model Booking {
  id              String         @id @default(cuid())
  startDate       DateTime
  endDate         DateTime
  totalPrice      Decimal
  status          BookingStatus  @default(PENDING)
  userId          String?
  carId           String
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  comments        String?
  companyAddress  String?
  companyEmail    String?
  companyName     String?
  companyPhone    String?
  companyTaxId    String?
  email           String
  firstName       String
  flightNumber    String?
  isCompany       Boolean        @default(false)
  lastName        String
  paymentMethod   String         @default("CASH_ON_SITE")
  phone           String
  dropoffLocation String         @default("Budapest Airport")
  fullInsurance   Boolean        @default(false)
  pickupLocation  String         @default("Budapest Airport")
  insurancePlanId String?
  car             Car            @relation(fields: [carId], references: [id])
  insurancePlan   InsurancePlan? @relation(fields: [insurancePlanId], references: [id])
  user            User?          @relation(fields: [userId], references: [id])
  extras          Extra[]        @relation("BookingToExtra")
}

model DamageReport {
  id          String   @id @default(cuid())
  description String
  images      String[]
  carId       String
  createdAt   DateTime @default(now())
  car         Car      @relation(fields: [carId], references: [id])
}

model PricingTier {
  id          String   @id @default(cuid())
  carId       String
  minDays     Int
  maxDays     Int?
  pricePerDay Decimal
  deposit     Decimal
  createdAt   DateTime @default(now())
  car         Car      @relation(fields: [carId], references: [id])
}

model Availability {
  id        String    @id @default(cuid())
  carId     String
  startDate DateTime
  endDate   DateTime
  status    CarStatus
  createdAt DateTime  @default(now())
  car       Car       @relation(fields: [carId], references: [id])
}

model Translation {
  id         String   @id @default(cuid())
  entityId   String
  entityType String
  field      String
  language   String
  value      String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([entityId, entityType, field, language])
}

enum Role {
  USER
  ADMIN
  SUPERADMIN
  PARTNER
}

enum CarStatus {
  AVAILABLE
  RENTED
  MAINTENANCE
  OUT_OF_SERVICE
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

enum FuelType {
  PETROL
  DIESEL
  ELECTRIC
  HYBRID
}

enum Transmission {
  MANUAL
  AUTOMATIC
}
